-- ‚úÖ Correct OrionLib
local OrionLib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/ionlyusegithubformcmods/1-Line-Scripts/main/Mobile%20Friendly%20Orion')))()
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local UIS = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Player = Players.LocalPlayer

-- UI Window
local Window = OrionLib:MakeWindow({
    Name = "üå≤ 99 Nights in the Forest üåô",
    HidePremium = false,
    SaveConfig = true,
    ConfigFolder = "NightsConfig"
})

-- Notify
OrionLib:MakeNotification({
    Name = "Welcome!",
    Content = "Enjoy, " .. Player.Name .. "!",
    Image = "rbxassetid://4483345998",
    Time = 5
})

-- üü¶ Variables
local settings = {
    NoFog = false,
    FullBright = false,
    Fly = false,
    ESP = {
        Deer = false,
        Players = false,
        Rabbits = false,
        Wolves = false,
        Scraps = false
    }
}

-- üåû Auto Refresh Lighting every 0.1s
RunService.RenderStepped:Connect(function()
    if settings.FullBright then
        Lighting.Brightness = 2
        Lighting.ClockTime = 12
        Lighting.FogEnd = 1e10
        Lighting.GlobalShadows = false
        Lighting.OutdoorAmbient = Color3.new(1, 1, 1)
    end
    if settings.NoFog then
        Lighting.FogEnd = 1e10
    end
end)

-- ‚úàÔ∏è Fly Setup
local connection
local function startFly()
    local char = Player.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root then return end

    local bg = Instance.new("BodyGyro", root)
    bg.P = 9e4
    bg.maxTorque = Vector3.new(9e9, 9e9, 9e9)
    bg.CFrame = root.CFrame

    local bv = Instance.new("BodyVelocity", root)
    bv.velocity = Vector3.zero
    bv.maxForce = Vector3.new(9e9, 9e9, 9e9)

    connection = RunService.RenderStepped:Connect(function()
        local camCF = Workspace.CurrentCamera.CFrame
        local move = Vector3.zero

        if UIS:IsKeyDown(Enum.KeyCode.W) then move += camCF.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.S) then move -= camCF.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.A) then move -= camCF.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.D) then move += camCF.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.Space) then move += Vector3.yAxis end
        if UIS:IsKeyDown(Enum.KeyCode.LeftControl) then move -= Vector3.yAxis end

        bv.Velocity = move.Unit * 80
        bg.CFrame = camCF
    end)
end

local function stopFly()
    if connection then connection:Disconnect() end
    local root = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if root then
        for _,v in pairs(root:GetChildren()) do
            if v:IsA("BodyGyro") or v:IsA("BodyVelocity") then v:Destroy() end
        end
    end
end

-- üß† ESP Utility
local function highlightModel(model, color, tag)
    if model:FindFirstChild("HumanoidRootPart") and not model:FindFirstChild(tag) then
        local highlight = Instance.new("Highlight", model)
        highlight.Name = tag
        highlight.Adornee = model
        highlight.FillColor = color
        highlight.FillTransparency = 0.3
        highlight.OutlineColor = color
    end
end

local function removeESP(tag)
    for _, m in pairs(Workspace:GetDescendants()) do
        if m:IsA("Model") and m:FindFirstChild(tag) then
            m[tag]:Destroy()
        end
    end
end

-- üå≥ Main Tab
local MainTab = Window:MakeTab({
    Name = "Main",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

MainTab:AddTextbox({
    Name = "üèÉ WalkSpeed",
    Default = "16",
    TextDisappear = true,
    Callback = function(val)
        local h = Player.Character and Player.Character:FindFirstChildOfClass("Humanoid")
        if h then h.WalkSpeed = tonumber(val) or 16 end
    end
})

MainTab:AddTextbox({
    Name = "ü¶ò JumpPower",
    Default = "50",
    TextDisappear = true,
    Callback = function(val)
        local h = Player.Character and Player.Character:FindFirstChildOfClass("Humanoid")
        if h then h.JumpPower = tonumber(val) or 50 end
    end
})

MainTab:AddToggle({
    Name = "üå´Ô∏è No Fog",
    Default = false,
    Callback = function(v)
        settings.NoFog = v
    end
})

MainTab:AddToggle({
    Name = "üí° FullBright",
    Default = false,
    Callback = function(v)
        settings.FullBright = v
    end
})

MainTab:AddToggle({
    Name = "üïäÔ∏è Fly Mode",
    Default = false,
    Callback = function(v)
        settings.Fly = v
        if v then startFly() else stopFly() end
    end
})

-- üß† Misc Tab (ESP)
local MiscTab = Window:MakeTab({
    Name = "Misc",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

-- ESP Loop
RunService.RenderStepped:Connect(function()
    if settings.ESP.Deer then
        for _, model in pairs(Workspace.Characters:GetChildren()) do
            if model.Name:lower():find("deer") then
                highlightModel(model, Color3.new(1, 0, 0), "ESP_Deer")
            end
        end
    else
        removeESP("ESP_Deer")
    end

    if settings.ESP.Players then
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= Player and p.Character then
                highlightModel(p.Character, Color3.new(0, 0, 1), "ESP_Player")
            end
        end
    else
        removeESP("ESP_Player")
    end

    if settings.ESP.Rabbits then
        for _, model in pairs(Workspace.Characters:GetChildren()) do
            if model.Name:lower():find("bunny") then
                highlightModel(model, Color3.new(1, 0.5, 0), "ESP_Bunny")
            end
        end
    else
        removeESP("ESP_Bunny")
    end

    if settings.ESP.Wolves then
        for _, model in pairs(Workspace.Characters:GetChildren()) do
            if model.Name:lower():find("wolf") then
                highlightModel(model, Color3.fromRGB(128, 0, 128), "ESP_Wolf")
            end
        end
    else
        removeESP("ESP_Wolf")
    end

    if settings.ESP.Scraps then
        for _, model in pairs(Workspace:GetDescendants()) do
            if model:IsA("Model") and model.Name:lower():find("scrap") then
                highlightModel(model, Color3.new(0, 1, 0), "ESP_Scrap")
            end
        end
    else
        removeESP("ESP_Scrap")
    end
end)

-- ESP Toggles
MiscTab:AddToggle({
    Name = "üî¥ Deer Monster ESP",
    Default = false,
    Callback = function(v) settings.ESP.Deer = v end
})
MiscTab:AddToggle({
    Name = "üîµ Players ESP",
    Default = false,
    Callback = function(v) settings.ESP.Players = v end
})
MiscTab:AddToggle({
    Name = "üü† Rabbits ESP",
    Default = false,
    Callback = function(v) settings.ESP.Rabbits = v end
})
MiscTab:AddToggle({
    Name = "üü£ Wolves ESP",
    Default = false,
    Callback = function(v) settings.ESP.Wolves = v end
})
MiscTab:AddToggle({
    Name = "üü¢ Scraps ESP",
    Default = false,
    Callback = function(v) settings.ESP.Scraps = v end
})

-- ‚úÖ Final Init
OrionLib:Init()
